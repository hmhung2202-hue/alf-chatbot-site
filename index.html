<script>
  async function sendMsg(e){
    e.preventDefault();
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if(!text) return;
    addMsg('user', text);
    input.value = '';

    try{
      document.getElementById('apiStatus').textContent = 'Đang gọi API...';
      const r = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages: [{ role: 'user', content: text }] })
      });

      const data = await r.json().catch(()=> ({}));
      document.getElementById('apiStatus').textContent = r.ok ? 'OK' : 'Lỗi API';

      // 👇 HIỆN LỖI CHI TIẾT nếu backend trả {error: "..."}
      if (!r.ok || data.error) {
        addMsg('bot', `Lỗi backend: ${data?.error || r.status + ' ' + r.statusText}`);
        return;
      }

      addMsg('bot', data.answer || 'Không có answer từ API.');
    } catch(err){
      document.getElementById('apiStatus').textContent = 'Lỗi API';
      addMsg('bot', 'Không gọi được API: ' + (err?.message || err));
    }
  }
</script>
