<script>
  async function sendMsg(e){
    e.preventDefault();
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if(!text) return;
    addMsg('user', text);
    input.value = '';

    try{
      document.getElementById('apiStatus').textContent = 'Äang gá»i API...';
      const r = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages: [{ role: 'user', content: text }] })
      });

      const data = await r.json().catch(()=> ({}));
      document.getElementById('apiStatus').textContent = r.ok ? 'OK' : 'Lá»—i API';

      // ğŸ‘‡ HIá»†N Lá»–I CHI TIáº¾T náº¿u backend tráº£ {error: "..."}
      if (!r.ok || data.error) {
        addMsg('bot', `Lá»—i backend: ${data?.error || r.status + ' ' + r.statusText}`);
        return;
      }

      addMsg('bot', data.answer || 'KhÃ´ng cÃ³ answer tá»« API.');
    } catch(err){
      document.getElementById('apiStatus').textContent = 'Lá»—i API';
      addMsg('bot', 'KhÃ´ng gá»i Ä‘Æ°á»£c API: ' + (err?.message || err));
    }
  }
</script>
